<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/templates/default/main.xhtml">
  <ui:define name="header">
    <h:outputScript name="js/controllers/users/index.js" />
  </ui:define>
  <ui:define name="content">
    <div ng-app="myApp" ng-controller="IndexUserController">
      <div class="row">
        <div class="col col-md-12">
          <h4>Employee Management</h4>
          <hr/>
        </div>
      </div>
      <div class="row" ng-app="myApp">
        <div class="col col-md-2">
          <abn-tree tree-data="units" on-select="changeUnit(branch)" expand-level="2" tree-control="unitsControl"></abn-tree>
        </div>
        <div class="col col-md-10" ng-switch="inTransferMode">
          <div class="col col-md-12" ng-switch-when="true">
            <div class="well">
              <p>You are about to transfer: {{toBeTransferedUser.id}}</p>
              <p>Select the unit to be transfered to on the left side</p>
              <button class="btn btn-danger btn-xs" ng-click="cancelTransferUser()">Cancel transfer</button>
            </div>
          </div>
          <div class="col col-md-12" ng-switch-default="true">
            <div class="alert alert-danger" ng-if="errors">
              <ul>
                <li ng-repeat="error in errors">{{error}}</li>
              </ul>
            </div>
            <div class="alert alert-info" ng-if="info">
              {{info}}
            </div>

            <div ng-switch="inEditMode">
              <div ng-switch-when="true">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label class="col-sm-1 control-label">Name</label>
                    <div class="col-sm-4">
                      <input class="form-control" ng-model="selectedUnit.data.name"/>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-1 control-label">Description</label>
                    <div class="col-sm-4">
                      <input class="form-control" ng-model="selectedUnit.data.description"/>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-sm-offset-1 col-sm-4">
                      <button class="btn btn-xs btn-primary" style="margin-left:10px" ng-click="updateUnit();">
                        <span class="glyphicon glyphicon-plus"/>
                        Save
                      </button>
                      <button class="btn btn-xs btn-danger" style="margin-left:5px" ng-click="editUnit(false)">
                        <span class="glyphicon glyphicon-trash"/>
                        Cancel
                      </button>
                    </div>
                  </div>
                </form>
              </div>
              <div ng-switch-default="true">
                <div ng-if="selectedUnit">
                  <h4>{{selectedUnit.data.name}}</h4>
                  {{selectedUnit.data.description}}
                  <br/><br/>
                </div>
                <button class="btn btn-xs btn-primary" style="margin-left:10px" data-toggle="modal" ng-click="displayNewUnitDialog();">
                  <span class="glyphicon glyphicon-plus"/>
                  Add sub unit
                </button>
                <button class="btn btn-xs btn-danger" style="margin-left:5px" ng-click="deleteUnit()" ng-disabled="!selectedUnit">
                  <span class="glyphicon glyphicon-trash"/>
                  Delete this unit
                </button>
                <button class="btn btn-xs btn-warning" style="margin-left:5px" ng-click="editUnit(true)" ng-disabled="!selectedUnit">
                  <span class="glyphicon glyphicon-edit"/>
                  Edit this unit
                </button>
              </div>
            </div>
          </div>
          <div class="col col-md-12" ng-switch-default="true">
            <hr/>
            <div style="margin-bottom:20px">
              <button class="btn btn-xs btn-info" ng-disabled="currentPage == 0" ng-click="prevPage()">Prev</button>
              {{currentPage + 1}} / {{totalPage}}
              <button class="btn btn-xs btn-info" ng-disabled="currentPage == totalPage - 1" ng-click="nextPage()">Next</button>
              <button class="btn btn-xs btn-primary" style="margin-left:10px" data-toggle="modal" ng-click="displayNewUserDialog()">
                <span class="glyphicon glyphicon-plus"/>
                Add employee
              </button>
            </div>
            <table class="table table-striped table-condensed">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>First name</th>
                  <th>Last name</th>
                  <th>Email</th>
                  <th style="width:200px"></th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="user in users" ng-switch="user.inEditMode">
                  <td ng-switch-when="true">{{user.id}}</td>
                  <td ng-switch-when="true"><input ng-model="user.firstName"/></td>
                  <td ng-switch-when="true"><input ng-model="user.lastName"/></td>
                  <td ng-switch-when="true"><input ng-model="user.email"/></td>
                  <td ng-switch-when="true">
                    <button class="btn btn-primary btn-xs" ng-click="updateUser(user)">Save</button>
                    <button class="btn btn-danger btn-xs" ng-click="editUser(user, false)">Cancel</button>
                  </td>

                  <td ng-switch-default="true">{{user.id}}</td>
                  <td ng-switch-default="true">{{user.firstName}}</td>
                  <td ng-switch-default="true">{{user.lastName}}</td>
                  <td ng-switch-default="true">{{user.email}}</td>
                  <td ng-switch-default="true">
                    <button class="btn btn-warning btn-xs" ng-click="editUser(user, true)">Edit</button>
                    <button class="btn btn-info btn-xs" ng-click="transferUser(user)">Transfer</button>
                    <button class="btn btn-danger btn-xs" ng-click="leaveUser(user)">Leave</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="modal fade new-employee-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="myModalLabel">New employee</h4>
            </div>
            <div class="modal-body">
              <div class="alert alert-danger" ng-if="errors">
                <ul>
                  <li ng-repeat="error in errors">{{error}}</li>
                </ul>
              </div>
              <div class="alert alert-info" ng-if="info">
                {{info}}
              </div>
              <form class="form-horizontal">
                <div class="form-group">
                  <label class="col-sm-3 control-label">Id</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="id" ng-model="newUser.id"/>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">First name</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="firstName" ng-model="newUser.firstName"/>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">Last name</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="lastName" ng-model="newUser.lastName"/>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">Email</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="email" ng-model="newUser.email"/>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">Password</label>
                  <div class="col-sm-9">
                    <input type="password" class="form-control" id="email" ng-model="newUser.password"/>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-sm-offset-3 col-sm-4">
                    <button class="btn btn-primary btn-sm" ng-click="createUser()">Create</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade new-unit-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="myModalLabel">New Unit</h4>
            </div>
            <div class="modal-body">
              <div class="alert alert-danger" ng-if="errors">
                <ul>
                  <li ng-repeat="error in errors">{{error}}</li>
                </ul>
              </div>
              <div class="alert alert-info" ng-if="info">
                {{info}}
              </div>
              <form class="form-horizontal">
                <div class="form-group">
                  <label class="col-sm-3 control-label">Name</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="id" ng-model="newUnit.name"/>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">Description</label>
                  <div class="col-sm-9">
                    <input class="form-control" id="firstName" ng-model="newUnit.description"/>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-sm-offset-3 col-sm-4">
                    <button class="btn btn-primary btn-sm" ng-click="createUnit()">Create</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ui:define>
</ui:composition>
</html>
