<div class="row">
  <div class="col-md-12">
    <h4>
      Reservation Details #{{reservations[0].groupId}}
      <span class="label label-danger" ng-if="!reservations[0].fullyPaid">INCOMPLETE PAYMENT</span>
      <span class="label label-success" ng-if="reservations[0].fullyPaid">COMPLETE PAYMENT</span>

      <span class="label label-primary" ng-if="reservations[0].status == 'SCHEDULED'">{{reservations[0].status}}</span>
      <span class="label label-danger" ng-if="reservations[0].status == 'CANCELED'">{{reservations[0].status}}</span>
      <span class="label label-success" ng-if="reservations[0].status == 'STARTED'">{{reservations[0].status}}</span>
      <span class="label label-warning" ng-if="reservations[0].status == 'FINISHED'">{{reservations[0].status}}</span>
    </h4>
    <div ng-if="isAdmin">
      <button class="btn btn-sm btn-success" ng-click="startRental()" ng-if="reservations[0].status == 'SCHEDULED'">
        <span class="glyphicon glyphicon-play"/>
        Start rental
      </button>
      <button class="btn btn-sm btn-warning" ng-click="finishRental()" ng-if="reservations[0].status == 'STARTED'">
        <span class="glyphicon glyphicon-stop"/>
        Finish rental
      </button>
      <button class="btn btn-sm btn-danger" ng-click="cancelRental()" ng-if="reservations[0].status == 'SCHEDULED'">
        <span class="glyphicon glyphicon-remove-circle"/>
        Cancel reservation
      </button>
    </div>
    <hr/>
  </div>

  <div class="col-md-3">
    <h4>Customer information</h4>
    <table class="table table-striped table-condensed">
      <tbody>
        <tr>
          <td>User Id</td>
          <td>{{reservations[0].customer.user.id}}</td>
        </tr>
        <tr>
          <td>First name</td>
          <td>{{reservations[0].customer.user.firstName}}
        </tr>
        <tr>
          <td>Last name</td>
          <td>{{reservations[0].customer.user.lastName}}
        </tr>
        <tr>
          <td>Email</td>
          <td>{{reservations[0].customer.user.email}}
        </tr>
        <tr>
          <td>Phone</td>
          <td>{{reservations[0].customer.user.phone}}
        </tr>
        <tr>
          <td>Address</td>
          <td>{{reservations[0].customer.address}}
        </tr>
        <tr>
          <td>Postal code</td>
          <td>{{reservations[0].customer.postalCode}}
        </tr>
        <tr>
          <td>Birth date</td>
          <td>{{reservations[0].customer.birthDate | date: 'medium'}}
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-md-3">
    <h4>Travel information</h4>
    <table class="table table-striped table-condensed">
      <tbody>
        <tr>
          <td>From</td>
          <td ng-if="!inEditScheduleMode">{{reservations[0].startTime | date: 'medium'}}</td>
          <td ng-if="inEditScheduleMode">
            <div class="dropdown control-label" style="text-align:left">
              <a  class="dropdown-toggle" id="dropdown1" role="button"
                data-toggle="dropdown" data-target="#" href="">{{newSchedule.startTime | date:'medium'}}</a>
              <ul class="dropdown-menu" role="menu">
                  <datetimepicker data-ng-model="newSchedule.startTime"
                    data-datetimepicker-config="{ dropdownSelector: '#dropdown1', minView: 'hour' }"/>
              </ul>
            </div>
          </td>
        </tr>
        <tr>
          <td>To</td>
          <td ng-if="!inEditScheduleMode">{{reservations[0].endTime | date: 'medium'}}</td>
          <td ng-if="inEditScheduleMode">
            <div class="dropdown control-label" style="text-align:left">
              <a  class="dropdown-toggle" id="dropdown2" role="button"
                data-toggle="dropdown" data-target="#" href="">{{newSchedule.endTime | date:'medium'}}</a>
              <ul class="dropdown-menu" role="menu">
                  <datetimepicker data-ng-model="newSchedule.endTime"
                    data-datetimepicker-config="{ dropdownSelector: '#dropdown2', minView: 'hour' }"/>
              </ul>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div ng-if="reservations[0].status != 'FINISHED' && reservations[0].status != 'CANCELED'">
      <button ng-if="!inEditScheduleMode" class="btn btn-danger btn-sm" ng-click="editSchedule(true)">Reschedule</button>
      <button ng-if="inEditScheduleMode" class="btn btn-primary btn-sm" ng-click="confirmReschedule();">Save</button>
      <button ng-if="inEditScheduleMode" class="btn btn-warning btn-sm" ng-click="editSchedule(false)">Cancel</button>
    </div>
    <hr/>
    <div ng-if="reservations[0].assignedDriver">
      <h4>Driver required</h4>
      <table class="table table-striped table-condensed">
        <tbody>
          <tr>
            <td>First name</td>
            <td>{{reservations[0].assignedDriver.firstName}}</td>
          </tr>
          <tr>
            <td>Last name</td>
            <td>{{reservations[0].assignedDriver.lastName}}</td>
          </tr>
          <tr>
            <td>Email</td>
            <td>{{reservations[0].assignedDriver.email}}</td>
          </tr>
          <tr>
            <td>Phone</td>
            <td>{{reservations[0].assignedDriver.phone}}</td>
          </tr>
        </tbody>
      </table>
      <a class="btn btn-primary btn-sm" ng-href="{{parentUrl}}/users/agenda.jsf?userId={{reservations[0].assignedDriver.id}}">Check Agenda</a>
    </div>
  </div>
  <div class="col-md-3">
    <h4>Reserved inventories detail</h4>
    <ol>
      <li ng-repeat="reservation in reservations">
        <a ng-href="{{parentUrl}}/inventories/index.jsf#/{{reservation.inventory.owner.id}}/inventories/{{reservation.inventory.id}}/detail?entity={{reservation.inventory.type}}">{{reservation.inventory.name}}</a>

        <span class="label label-primary" ng-if="reservation.inventory.status == 'AVAILABLE'">{{reservation.inventory.status}}</span>
        <span class="label label-success" ng-if="reservation.inventory.status == 'RENTED'">{{reservation.inventory.status}}</span>
        <span class="label label-danger" ng-if="reservation.inventory.status == 'BROKEN'">{{reservation.inventory.status}}</span>
        <span class="label label-default" ng-if="reservation.inventory.status == 'DELETED'">{{reservation.inventory.status}}</span>
        <span class="label label-warning" ng-if="reservation.inventory.status == 'RETURNED'">{{reservation.inventory.status}}</span>
      </li>
    </ol>
  </div>
  <div class="col-md-3">
    <h4>Payment</h4>
    <table class="table table-condensed table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th align="right">Price</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="reservation in reservations">
          <td>{{reservation.inventory.name}}</td>
          <td ng-if="reservation.status == 'CANCELED'" align="right">{{selectedBranch.currencySymbol}} 0</td>
          <td ng-if="reservation.status != 'CANCELED'" align="right">{{selectedBranch.currencySymbol}} {{reservation.inventoryFee}}</td>
        </tr>
        <tr ng-if="reservations[0].assignedDriver">
          <td>Driver</td>
          <td ng-if="reservations[0].status == 'CANCELED'" align="right">{{selectedBranch.currencySymbol}} 0</td>
          <td ng-if="reservations[0].status != 'CANCELED'" align="right">{{selectedBranch.currencySymbol}} {{reservations[0].driverFee}}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr ng-if="totalOverdueFee > 0">
          <td style="color:red"><b>Overdue</b></td>
          <td style="color:red" ng-if="reservations[0].status == 'CANCELED'" align="right"><b>{{selectedBranch.currencySymbol}} 0</b></td>
          <td style="color:red" ng-if="reservations[0].status != 'CANCELED'" align="right"><b>{{selectedBranch.currencySymbol}} {{totalOverdueFee}}</b></td>
        </tr>
        <tr>
          <td><b>Penalty</b></td>
          <td ng-if="reservations[0].status == 'CANCELED'" align="right">{{selectedBranch.currencySymbol}} 0</td>
          <td ng-if="reservations[0].status != 'CANCELED'" align="right">
            {{selectedBranch.currencySymbol}} <input style="float:right; margin-left: 10px; width:100px; text-align:right;" class="form-control" ng-model="reservations[0].penaltyFee"/>
          </td>
        </tr>
        <tr>
          <td><b>Total</b></td>
          <td ng-if="reservations[0].status == 'CANCELED'" align="right"><b>{{selectedBranch.currencySymbol}} 0</b></td>
          <td ng-if="reservations[0].status != 'CANCELED'" align="right"><b>{{selectedBranch.currencySymbol}} {{totalPrice(reservations)}}</b></td>
        </tr>
        <tr style="margin-top:200px">
          <td><b>Paid amount</b></td>
          <td align="right">
            <b>{{selectedBranch.currencySymbol}} <input style="float:right; margin-left: 10px; width:100px; text-align:right;" class="form-control" ng-model="reservations[0].paidAmount"/></b>
            <br/><br/>
            <button ng-if="reservations[0].status == 'CANCELED'" style="margin-top:10px" class="btn btn-xs btn-warning" ng-click="reservations[0].paidAmount = 0">Copy Total</button>
            <button ng-if="reservations[0].status != 'CANCELED'" style="margin-top:10px" class="btn btn-xs btn-warning" ng-click="reservations[0].paidAmount = totalPrice(reservations)">Copy Total</button>
          </td>
        </tr>
        <tr>
          <td><b style="color:blue">Balance</b></td>
          <td ng-if="reservations[0].status == 'CANCELED'" align="right" style="color:blue"><b>{{selectedBranch.currencySymbol}} {{reservations[0].paidAmount}}</b></td>
          <td ng-if="reservations[0].status != 'CANCELED'" align="right" style="color:blue"><b>{{selectedBranch.currencySymbol}} {{reservations[0].paidAmount - totalPrice(reservations)}}</b></td>
        </tr>
        <tr>
          <td></td>
          <td align="right">
            <button class="btn btn-success btn-sm" ng-click="updatePayment()">Update payment</button><br/><br/>
            <button class="btn btn-sm btn-primary" ng-click="markFullyPaid()" ng-if="!reservations[0].fullyPaid && reservations[0].status != 'CANCELED'">
              <span class="glyphicon glyphicon-ok"/>
              Full payment received
            </button>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
<div class="row" ng-show="reservations[0].status == 'STARTED'">
  <div class="col col-md-6">
    <h4>Location</h4>
    <div id="map-canvas"></div>
  </div>
</div>